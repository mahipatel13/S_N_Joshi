<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delete Menu</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_ui.css') }}">
    <style>
        .period-title {
            margin: 0 0 10px;
            text-align: center;
            font-size: 20px;
            color: #334155;
            font-weight: 600;
        }
    </style>
</head>
<body class="admin-ui-body">
    <div class="page-shell">
        <div class="hero">
            <h1>Delete Menu</h1>
            <p>Review weekly cycles carefully before deleting records</p>
        </div>

        {% set all_ids = (breakfast + lunch + dinner) | map(attribute='id') | unique | list %}
        {% for unique_id in all_ids %}
        {% set menu_item = (breakfast + lunch + dinner) | selectattr('id', 'equalto', unique_id) | list | first %}

        <section class="panel panel-pad" style="margin-bottom: 16px;">
            <h2 class="period-title">Menu Period: {{ menu_item.from_date }} - {{ menu_item.to_date }}</h2>
            <div class="table-shell">
                <table class="table-modern">
                    <tr>
                        <th>ID</th>
                        <th>Meal Type</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                        <th>Saturday</th>
                        <th>Sunday</th>
                        <th>From Date</th>
                        <th>To Date</th>
                        <th>Created At</th>
                        <th>Action</th>
                    </tr>

                    {% for item in breakfast if item.id == unique_id %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>Breakfast</td>
                        <td>{{ item.Monday }}</td>
                        <td>{{ item.Tuesday }}</td>
                        <td>{{ item.Wednesday }}</td>
                        <td>{{ item.Thursday }}</td>
                        <td>{{ item.Friday }}</td>
                        <td>{{ item.Saturday }}</td>
                        <td>{{ item.Sunday }}</td>
                        <td>{{ item.from_date }}</td>
                        <td>{{ item.to_date }}</td>
                        <td>{{ item.created_at }}</td>
                        <td><button class="btn-pill danger" onclick="deleteMenuItem('breakfast', {{ item.id }})">Delete</button></td>
                    </tr>
                    {% endfor %}

                    {% for item in lunch if item.id == unique_id %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>Lunch</td>
                        <td>{{ item.Monday }}</td>
                        <td>{{ item.Tuesday }}</td>
                        <td>{{ item.Wednesday }}</td>
                        <td>{{ item.Thursday }}</td>
                        <td>{{ item.Friday }}</td>
                        <td>{{ item.Saturday }}</td>
                        <td>{{ item.Sunday }}</td>
                        <td>{{ item.from_date }}</td>
                        <td>{{ item.to_date }}</td>
                        <td>{{ item.created_at }}</td>
                        <td><button class="btn-pill danger" onclick="deleteMenuItem('lunch', {{ item.id }})">Delete</button></td>
                    </tr>
                    {% endfor %}

                    {% for item in dinner if item.id == unique_id %}
                    <tr>
                        <td>{{ item.id }}</td>
                        <td>Dinner</td>
                        <td>{{ item.Monday }}</td>
                        <td>{{ item.Tuesday }}</td>
                        <td>{{ item.Wednesday }}</td>
                        <td>{{ item.Thursday }}</td>
                        <td>{{ item.Friday }}</td>
                        <td>{{ item.Saturday }}</td>
                        <td>{{ item.Sunday }}</td>
                        <td>{{ item.from_date }}</td>
                        <td>{{ item.to_date }}</td>
                        <td>{{ item.created_at }}</td>
                        <td><button class="btn-pill danger" onclick="deleteMenuItem('dinner', {{ item.id }})">Delete</button></td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
        </section>
        {% endfor %}

        <div class="btn-row">
            <a href="/admin_dashboard" class="btn-pill gray">Back to Dashboard</a>
        </div>
    </div>

    <script>
        function deleteMenuItem(meal, id) {
            if (!confirm("Are you sure you want to delete this menu?")) {
                return;
            }

            fetch(`/delete_menu/${meal}/${id}`, { method: "POST" })
                .then(response => response.json())
                .then(data => {
                    alert(data.message || "Deleted");
                    location.reload();
                })
                .catch(error => console.error("Error:", error));
        }
    </script>
</body>
</html>
